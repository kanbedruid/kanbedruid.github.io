<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>åƒä»£ Ã— å°å¾·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ä¸­æ–‡ + å†·é™è‰ºæœ¯æ„Ÿå­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500;700&family=Inter:wght@300;400&display=swap" rel="stylesheet">

  <style>
    :root {
      --fg: #e8e8f0;
      --muted: #a0a0b8;
      --accent: #b7a8ff;
      --border-light: rgba(255,255,255,0.18);
      --bg-btn: rgba(255,255,255,0.03);
      --season-btn-size: 40px;
      --btn-backdrop-blur: 8px; /* æŒ‰é’®æ¯›ç»ç’ƒæ¨¡ç³Šåº¦ */
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: auto;
      color: var(--fg);
      font-family: Inter, sans-serif;
      /* é»˜è®¤æ˜Ÿç©ºèƒŒæ™¯ï¼Œåç»­é€šè¿‡JSåˆ‡æ¢ */
      background:
        radial-gradient(1200px 800px at 20% 10%, #1b1f3b 0%, transparent 60%),
        radial-gradient(1000px 700px at 80% 20%, #2a174a 0%, transparent 65%),
        linear-gradient(180deg, #090b16, #05060c);
      transition: background 1s ease-in-out;
      scroll-behavior: smooth;
    }

    /* å­£èŠ‚åˆ‡æ¢æŒ‰é’®æ ·å¼ */
    .season-switch-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: var(--season-btn-size);
      height: var(--season-btn-size);
      border-radius: 50%;
      border: 1px solid var(--border-light);
      background: var(--bg-btn);
      backdrop-filter: blur(var(--btn-backdrop-blur));
      color: var(--fg);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: transform 0.3s ease, border-color 0.3s ease, background 1s ease-in-out, color 1s ease-in-out;
    }

    .season-switch-btn:hover {
      transform: scale(1.1);
      border-color: var(--accent);
    }

    canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
    }

    main {
      position: relative;
      z-index: 1;
      min-height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px 80px;
    }

    .container {
      text-align: center;
      max-width: 800px;
      width: 100%;
    }

    /* æ¢å¤å¤§æ ‡é¢˜ä¸º åƒä»£ Ã— å°å¾· */
    h1 {
      font-family: "Noto Serif SC", serif;
      font-size: 46px;
      letter-spacing: 4px;
      margin-bottom: 12px;
      transition: color 1s ease-in-out;
    }

    .subtitle {
      font-size: 14px;
      letter-spacing: 6px;
      color: var(--muted);
      margin-bottom: 30px;
      transition: color 1s ease-in-out;
    }

    /* ===== æ—¥å† + ä¸»æŒ‰é’® å¹¶æ’å®¹å™¨ ===== */
    .calendar-main-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
      margin-bottom: 40px;
      width: 100%;
    }

    /* ===== å°å‹æ—¥å†è¡¨æ ¼ ===== */
    .mini-calendar {
      width: 220px;
      border: 1px solid var(--border-light);
      backdrop-filter: blur(var(--btn-backdrop-blur));
      border-radius: 8px;
      overflow: hidden;
      flex-shrink: 0; /* é˜²æ­¢æ—¥å†è¢«å‹ç¼© */
      position: relative;
      z-index: 1;
      transition: background 1s ease-in-out, border-color 1s ease-in-out, color 1s ease-in-out;
    }

    .calendar-header {
      padding: 8px;
      background: var(--bg-btn);
      border-bottom: 1px solid var(--border-light);
      transition: background 1s ease-in-out, border-color 1s ease-in-out;
    }

    .calendar-week, .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-week span, .calendar-days span {
      padding: 6px;
      font-size: 12px;
      text-align: center;
      transition: color 1s ease-in-out;
    }

    .calendar-week span {
      color: var(--muted);
      letter-spacing: 1px;
    }

    .calendar-days span {
      color: var(--fg);
      cursor: default;
    }

    .calendar-days span.current {
      color: var(--accent);
      font-weight: 500;
    }

    /* ===== æ ¸å¿ƒæŒ‰é’®å¸ƒå±€ ===== */
    /* é¡¶éƒ¨ï¼šæˆ‘ä»¬çš„æ¯ä¸€å¤©ï¼ˆä¸»æŒ‰é’®ï¼‰- ä¸æ—¥å†å¹¶æ’ */
    .main-btn {
      position: relative;
      padding: 40px 26px;
      border: 1px solid var(--border-light);
      background: var(--bg-btn);
      backdrop-filter: blur(var(--btn-backdrop-blur));
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, background 1s ease-in-out;
      border-radius: 12px;
      flex: 1; /* å æ®å‰©ä½™å®½åº¦ */
      min-width: 300px; /* ä¿è¯æŒ‰é’®æœ€å°å®½åº¦ */
      z-index: 1;
    }

    /* ä¸‹æ–¹ï¼šå¥åº·ç”Ÿæ´» + å·¦å³å¸ƒå±€å®¹å™¨ */
    .secondary-buttons {
      display: flex;
      flex-direction: column;
      gap: 40px;
      width: 100%;
    }

    /* å¥åº·ç”Ÿæ´»æŒ‰é’® */
    .health-btn {
      position: relative;
      padding: 30px 26px;
      border: 1px solid var(--border-light);
      background: var(--bg-btn);
      backdrop-filter: blur(var(--btn-backdrop-blur));
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, background 1s ease-in-out;
      border-radius: 12px;
      width: 100%;
      z-index: 1;
    }

    /* å·¦å³å¸ƒå±€ï¼šæ„¿æœ›æ¸…å• | ç¾é£ŸåŒºåŸŸï¼ˆç¾é£Ÿåå¥½ + ä¸‹æ–¹é“¾æ¥ï¼‰ */
    .side-by-side {
      display: flex;
      gap: 20px;
      width: 100%;
    }

    /* æ„¿æœ›æ¸…å•ï¼ˆå·¦ä¾§ï¼Œç­‰å®½ï¼‰ */
    .wish-btn {
      position: relative;
      padding: 60px 26px;
      border: 1px solid var(--border-light);
      background: var(--bg-btn);
      backdrop-filter: blur(var(--btn-backdrop-blur));
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, background 1s ease-in-out;
      border-radius: 12px;
      flex: 1; /* ä¸ç¾é£ŸåŒºåŸŸç­‰å®½ */
      display: flex;
      flex-direction: column;
      justify-content: center;
      z-index: 1;
    }

    /* å³ä¾§ï¼šç¾é£ŸåŒºåŸŸï¼ˆç¾é£Ÿåå¥½æŒ‰é’® + ä¸‹æ–¹é“¾æ¥ï¼‰ */
    .food-area {
      flex: 1; /* ä¸æ„¿æœ›æ¸…å•ç­‰å®½ */
      display: flex;
      flex-direction: column;
      align-items: center; /* é“¾æ¥å±…ä¸­å¯¹é½æŒ‰é’® */
      gap: 16px; /* æŒ‰é’®ä¸é“¾æ¥çš„é—´è· */
      z-index: 1;
    }

    /* ç¾é£Ÿåå¥½ï¼ˆå³ä¾§ï¼Œç­‰å®½ï¼‰ */
    .food-prefer-btn {
      position: relative;
      padding: 60px 26px;
      border: 1px solid var(--border-light);
      background: var(--bg-btn);
      backdrop-filter: blur(var(--btn-backdrop-blur));
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.3s ease, border-color 0.3s ease, background 1s ease-in-out;
      border-radius: 12px;
      width: 100%; /* å¡«æ»¡ç¾é£ŸåŒºåŸŸå®½åº¦ */
      display: flex;
      flex-direction: column;
      justify-content: center;
      z-index: 1;
    }

    /* ç¾é£Ÿæ’åä¸‹åˆ’çº¿é“¾æ¥ï¼ˆæŒ‰é’®å¤–éƒ¨æ­£ä¸‹æ–¹ï¼‰ */
    .food-rank-link {
      font-size: 13px;
      color: var(--muted);
      text-decoration: underline;
      text-decoration-color: var(--border-light);
      cursor: pointer;
      transition: color 0.3s ease, text-decoration-color 0.3s ease, color 1s ease-in-out;
      align-self: center; /* æ°´å¹³å±…ä¸­ */
      z-index: 1;
    }

    .food-rank-link:hover {
      color: var(--accent);
      text-decoration-color: var(--accent);
    }

    /* æ‰€æœ‰æŒ‰é’®çš„é€šç”¨ä¼ªå…ƒç´ ï¼ˆå…‰æ–‘æ•ˆæœï¼‰ */
    .main-btn::before, .health-btn::before, .wish-btn::before, .food-prefer-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at var(--x, 50%) var(--y, 50%),
        rgba(183,168,255,0.35),
        transparent 65%
      );
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 0;
    }

    .main-btn:hover::before, .health-btn:hover::before, .wish-btn:hover::before, .food-prefer-btn:hover::before {
      opacity: 1;
    }

    /* æ‰€æœ‰æŒ‰é’®çš„é€šç”¨hover/activeæ•ˆæœ */
    .main-btn:hover, .health-btn:hover, .wish-btn:hover, .food-prefer-btn:hover {
      transform: translateY(-5px);
      border-color: var(--accent);
    }

    .main-btn:active, .health-btn:active, .wish-btn:active, .food-prefer-btn:active {
      transform: scale(0.97);
    }

    /* æŒ‰é’®æ–‡å­—æ ·å¼ */
    .btn-title {
      font-family: "Noto Serif SC", serif;
      font-size: 22px;
      margin-bottom: 10px;
      transition: color 1s ease-in-out;
      z-index: 1;
      position: relative;
    }

    .main-btn .btn-title {
      font-size: 26px;
    }

    .btn-desc {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.7;
      transition: color 1s ease-in-out;
      z-index: 1;
      position: relative;
    }

    footer {
      position: fixed;
      bottom: 22px;
      width: 100%;
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 3px;
      z-index: 1;
      transition: color 1s ease-in-out;
    }

    @media (max-width: 640px) {
      h1 { font-size: 34px; }
      /* å°å±å¹•ä¸‹æ—¥å†å’Œä¸»æŒ‰é’®æ”¹ä¸ºä¸Šä¸‹å¸ƒå±€ */
      .calendar-main-wrap {
        flex-direction: column;
        gap: 20px;
      }
      .main-btn {
        min-width: unset;
        width: 100%;
      }
      /* å°å±å¹•ä¸‹å·¦å³å¸ƒå±€æ”¹ä¸ºä¸Šä¸‹ */
      .side-by-side {
        flex-direction: column;
      }
      .wish-btn, .food-prefer-btn {
        padding: 30px 26px;
      }
      .season-switch-btn {
        width: calc(var(--season-btn-size) - 10px);
        height: calc(var(--season-btn-size) - 10px);
        font-size: 14px;
      }
    }
  </style>
</head>

<body>
  <!-- å­£èŠ‚åˆ‡æ¢æŒ‰é’® -->
  <button class="season-switch-btn" id="seasonSwitchBtn">ğŸŒŒ</button>

  <canvas id="bg"></canvas>

  <main>
    <div class="container">
      <!-- æ¢å¤å¤§æ ‡é¢˜ï¼šåƒä»£ Ã— å°å¾· -->
      <h1>åƒä»£ Ã— å°å¾·</h1>
      <div class="subtitle">æˆ‘ä»¬çš„è®°å½•</div>

      <!-- æ—¥å† + ä¸»æŒ‰é’® å¹¶æ’å®¹å™¨ -->
      <div class="calendar-main-wrap">
        <!-- å°å‹æ—¥å†è¡¨æ ¼ -->
        <div class="mini-calendar" id="miniCalendar">
          <div class="calendar-header">
            <span style="font-size: 14px; letter-spacing: 2px;">2026 Â· 01</span>
          </div>
          <div class="calendar-week">
            <span>æ—¥</span>
            <span>ä¸€</span>
            <span>äºŒ</span>
            <span>ä¸‰</span>
            <span>å››</span>
            <span>äº”</span>
            <span>å…­</span>
          </div>
          <div class="calendar-days">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span>1</span>
            <span>2</span>
            <span>3</span>
          </div>
          <div class="calendar-days">
            <span>4</span>
            <span>5</span>
            <span>6</span>
            <span>7</span>
            <span>8</span>
            <span>9</span>
            <span>10</span>
          </div>
          <div class="calendar-days">
            <span>11</span>
            <span>12</span>
            <span>13</span>
            <span class="current">14</span>
            <span>15</span>
            <span>16</span>
            <span>17</span>
          </div>
          <div class="calendar-days">
            <span>18</span>
            <span>19</span>
            <span>20</span>
            <span>21</span>
            <span>22</span>
            <span>23</span>
            <span>24</span>
          </div>
          <div class="calendar-days">
            <span>25</span>
            <span>26</span>
            <span>27</span>
            <span>28</span>
            <span>29</span>
            <span>30</span>
            <span>31</span>
          </div>
        </div>

        <!-- ä¸»æŒ‰é’®ï¼šæˆ‘ä»¬çš„æ¯ä¸€å¤©ï¼ˆæŒ‰é’®æ ‡é¢˜ï¼‰ -->
        <div class="main-btn" onclick="location.href='https://kanbedruid.github.io/days/'">
          <div class="btn-title">æˆ‘ä»¬çš„æ¯ä¸€å¤©</div>
          <div class="btn-desc">è®°å¿†ä¸­çš„é‡è¦æ—¶å…‰</div>
        </div>
      </div>

      <!-- ä¸‹æ–¹äºŒçº§æŒ‰é’®åŒºåŸŸ -->
      <div class="secondary-buttons">
        <!-- å¥åº·ç”Ÿæ´»æŒ‰é’® -->
        <div class="health-btn" onclick="location.href='https://kanbedruid.github.io/weight/'">
          <div class="btn-title">å¥åº·ç”Ÿæ´»</div>
          <div class="btn-desc">è°ƒæ•´ä½œæ¯ èµ¢å¾—ç§¯åˆ†</div>
        </div>

        <!-- å·¦å³å¸ƒå±€ï¼šæ„¿æœ›æ¸…å• | ç¾é£ŸåŒºåŸŸ -->
        <div class="side-by-side">
          <!-- å·¦ä¾§ï¼šæ„¿æœ›æ¸…å• -->
          <div class="wish-btn" onclick="location.href='https://kanbedruid.github.io/list'">
            <div class="btn-title">æ„¿æœ›æ¸…å•</div>
            <div class="btn-desc">å†™ä¸‹æƒ³è¦çš„ä¸œè¥¿ æ€»æœ‰ä¸€å¤©ä¼šå®ç°</div>
          </div>

          <!-- å³ä¾§ï¼šç¾é£ŸåŒºåŸŸï¼ˆç¾é£Ÿåå¥½æŒ‰é’® + ä¸‹æ–¹é“¾æ¥ï¼‰ -->
          <div class="food-area">
            <!-- ç¾é£Ÿåå¥½æŒ‰é’® -->
            <div class="food-prefer-btn" onclick="location.href='https://kanbedruid.github.io/like'">
              <div class="btn-title">ç¾é£Ÿåå¥½</div>
              <div class="btn-desc">æƒ³æƒ³ä»Šå¤©åƒä»€ä¹ˆ</div>
            </div>
            <!-- ç¾é£Ÿæ’åä¸‹åˆ’çº¿é“¾æ¥ï¼ˆæŒ‰é’®å¤–éƒ¨æ­£ä¸‹æ–¹ï¼‰ -->
            <div class="food-rank-link" onclick="location.href='https://kanbedruid.github.io/food/'">â†’ å°å¾·çš„é¥­åº—æ’å</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    ä¸€èµ·èµ°å‘æœªæ¥
  </footer>

  <script>
    // === å…¨å±€é…ç½® ===
    const canvas = document.getElementById("bg");
    const ctx = canvas.getContext("2d");
    const seasonSwitchBtn = document.getElementById("seasonSwitchBtn");
    let w, h;

    // å­£èŠ‚æšä¸¾ï¼ˆ0:æ˜Ÿç©º, 1:å†¬å¤©, 2:æ˜¥å¤©, 3:å¤å¤©, 4:ç§‹å¤©ï¼‰
    const SEASONS = {
      STARRY: 0,
      WINTER: 1,
      SPRING: 2,
      SUMMER: 3,
      AUTUMN: 4
    };
    let currentSeason = SEASONS.STARRY;
    const seasonIcons = ["ğŸŒŒ", "â„ï¸", "ğŸŒ¸", "â˜€ï¸", "ğŸ‚"];
    const seasonNames = ["æ˜Ÿç©º", "å†¬å¤©", "æ˜¥å¤©", "å¤å¤©", "ç§‹å¤©"];

    // è‡ªåŠ¨åˆ‡æ¢é…ç½®
    const AUTO_SWITCH_INTERVAL = 15000; // 15ç§’è‡ªåŠ¨åˆ‡æ¢
    let autoSwitchTimer = null;
    let isFading = false; // é˜²æ­¢æ¸å˜è¿‡ç¨‹ä¸­é‡å¤åˆ‡æ¢

    // å…ƒç´ è¾¹ç•Œç¼“å­˜ï¼ˆç”¨äºç§¯é›ª/èŠ±ç“£å †ç§¯æ£€æµ‹ï¼‰
    let elementBounds = [];

    // === å­£èŠ‚èµ„æºé…ç½® ===
    // æ˜Ÿç©ºé…ç½®
    let stars = [];
    const STAR_COUNT = 140;

    // å†¬å¤©é…ç½®ï¼ˆé›ªèŠ±ï¼‰
    let snowflakes = [];
    const SNOW_COUNT = 300;
    const SNOW_SIZE_RANGE = [1, 4];
    const SNOW_SPEED_RANGE = [0.1, 0.5];
    const SNOW_FLOAT_CHANCE = 0.02;

    // æ˜¥å¤©é…ç½®ï¼ˆæ¨±èŠ±ï¼‰- ä¼˜åŒ–ï¼šæ·¡ç²‰è‰²
    let sakuras = [];
    const SAKURA_COUNT = 250;
    const SAKURA_SIZE_RANGE = [2, 5];
    const SAKURA_SPEED_RANGE = [0.08, 0.4];
    const SAKURA_FLOAT_CHANCE = 0.03;

    // å¤å¤©é…ç½®ï¼ˆæµ·æµªã€æ°´ç ï¼‰
    let waves = [];
    let drops = [];
    const WAVE_COUNT = 3;
    const DROP_TYPES = [
      { size: 6, count: [3, 6], fadeTime: 6000 }, // å¤§æ°´ç 
      { size: 3, count: [3, 6], fadeTime: 4000 }, // ä¸­æ°´ç 
      { size: 1.5, count: [6, 12], fadeTime: 2000 } // å°æ°´ç 
    ];
    let lastWaveTime = 0;
    const WAVE_INTERVAL_RANGE = [3000, 7000];

    // ç§‹å¤©é…ç½®ï¼ˆæ ‘å¶ï¼‰- ä¼˜åŒ–ï¼šæ›´å¤§ã€æ›´æ…¢ã€æ›´å°‘ã€3ç§é¢œè‰²
    let leaves = [];
    const LEAF_COUNT = 80; // æ•°é‡å‡å°‘ï¼ˆåŸ200â†’80ï¼‰
    const LEAF_SIZE_RANGE = [6, 12]; // å°ºå¯¸å¢å¤§ï¼ˆåŸ3-7â†’6-12ï¼‰
    const LEAF_SPEED_RANGE = [0.05, 0.3]; // é€Ÿåº¦æ›´æ…¢ï¼ˆåŸ0.1-0.6â†’0.05-0.3ï¼‰
    const LEAF_FLOAT_CHANCE = 0.025;
    const LEAF_COLORS = ["#cd5c5c", "#daa520", "#b8860b"]; // 3ç§é¢œè‰²å›ºå®š

    // é¼ æ ‡çŠ¶æ€
    const mouse = { x: w / 2, y: h / 2, prevX: w / 2, prevY: h / 2, speedX: 0, speedY: 0 };

    // === åˆå§‹åŒ– ===
    function init() {
      resize();
      cacheElementBounds();
      initSeasonResources();
      startAutoSwitchTimer(); // å¯åŠ¨è‡ªåŠ¨åˆ‡æ¢å®šæ—¶å™¨
      animate();
    }

    // === ç”»å¸ƒè°ƒæ•´ ===
    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      mouse.x = w / 2;
      mouse.y = h / 2;
      cacheElementBounds();
      resetSeasonResources();
    }

    // === ç¼“å­˜å…ƒç´ è¾¹ç•Œï¼ˆå®æ—¶æ›´æ–°ï¼Œä¿®å¤æ»šåŠ¨BUGï¼‰ ===
    function cacheElementBounds() {
      elementBounds = [];
      const elements = document.querySelectorAll(".mini-calendar, .main-btn, .health-btn, .wish-btn, .food-prefer-btn");
      elements.forEach(el => {
        const rect = el.getBoundingClientRect(); // å®æ—¶è·å–å…ƒç´ è§†å£ä½ç½®
        elementBounds.push({
          x: rect.left,
          y: rect.top,
          width: rect.width,
          height: rect.height,
          top: rect.top,
          bottom: rect.bottom,
          left: rect.left,
          right: rect.right,
          el: el // å…³è”å…ƒç´ ï¼Œä¾¿äºåç»­éªŒè¯
        });
      });
      // æ·»åŠ é¡µé¢åº•éƒ¨è¾¹ç•Œï¼ˆåœ°é¢ï¼‰
      elementBounds.push({
        x: 0,
        y: h,
        width: w,
        height: 10,
        top: h,
        bottom: h + 10,
        left: 0,
        right: w
      });
    }

    // === å¯åŠ¨è‡ªåŠ¨åˆ‡æ¢å®šæ—¶å™¨ ===
    function startAutoSwitchTimer() {
      clearInterval(autoSwitchTimer);
      autoSwitchTimer = setInterval(() => {
        if (!isFading) {
          smoothSwitchSeason(); // å¹³æ»‘åˆ‡æ¢ä¸‹ä¸€ä¸ªå­£èŠ‚
        }
      }, AUTO_SWITCH_INTERVAL);
    }

    // === å¹³æ»‘åˆ‡æ¢å­£èŠ‚ï¼ˆæ¸å˜è¿‡æ¸¡ï¼‰ ===
    function smoothSwitchSeason() {
      isFading = true;
      // ç¬¬ä¸€æ­¥ï¼šæ¸éšå½“å‰å­£èŠ‚å…ƒç´ ï¼ˆé™ä½é€æ˜åº¦ï¼Œè€—æ—¶500msï¼‰
      const fadeOutTimer = setTimeout(() => {
        // ç¬¬äºŒæ­¥ï¼šåˆ‡æ¢å­£èŠ‚æ•°æ®
        currentSeason = (currentSeason + 1) % 5;
        seasonSwitchBtn.textContent = seasonIcons[currentSeason];
        updateSeasonStyle();
        resetSeasonResources();
        // ç¬¬ä¸‰æ­¥ï¼šæ¸æ˜¾æ–°å­£èŠ‚å…ƒç´ ï¼ˆè€—æ—¶500msï¼‰
        const fadeInTimer = setTimeout(() => {
          isFading = false;
          clearTimeout(fadeInTimer);
        }, 500);
        clearTimeout(fadeOutTimer);
      }, 500);
      // é‡å¯å®šæ—¶å™¨ï¼ˆé¿å…åˆ‡æ¢è¿‡ç¨‹ä¸­ç´¯è®¡æ—¶é—´åå·®ï¼‰
      startAutoSwitchTimer();
    }

    // === æ‰‹åŠ¨åˆ‡æ¢å­£èŠ‚ï¼ˆå…¼å®¹å¹³æ»‘è¿‡æ¸¡ï¼‰ ===
    function switchSeason() {
      if (!isFading) {
        smoothSwitchSeason();
      }
    }

    // === å­£èŠ‚èµ„æºåˆå§‹åŒ– ===
    function initSeasonResources() {
      // åˆå§‹åŒ–æ˜Ÿç©º
      stars = Array.from({ length: STAR_COUNT }, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 1.8 + 0.6,
        vx: (Math.random() - 0.5) * 0.25,
        vy: (Math.random() - 0.5) * 0.25
      }));

      // åˆå§‹åŒ–å†¬å¤©é›ªèŠ±
      snowflakes = Array.from({ length: SNOW_COUNT }, () => createSnowflake());

      // åˆå§‹åŒ–æ˜¥å¤©æ¨±èŠ±
      sakuras = Array.from({ length: SAKURA_COUNT }, () => createSakura());

      // åˆå§‹åŒ–å¤å¤©æµ·æµª
      waves = Array.from({ length: WAVE_COUNT }, (_, i) => ({
        y: h - 100 - i * 30,
        amplitude: 20 + i * 10,
        frequency: 0.01 - i * 0.002,
        speed: (0.02 + i * 0.005) / 2, // æµ·æµªé€Ÿåº¦å‡åŠ
        phase: Math.random() * Math.PI * 2
      }));

      // åˆå§‹åŒ–ç§‹å¤©æ ‘å¶
      leaves = Array.from({ length: LEAF_COUNT }, () => createLeaf());
    }

    // === é‡ç½®å­£èŠ‚èµ„æºï¼ˆçª—å£å¤§å°å˜åŒ–æ—¶ï¼‰ ===
    function resetSeasonResources() {
      switch (currentSeason) {
        case SEASONS.STARRY:
          stars = Array.from({ length: STAR_COUNT }, () => ({
            x: Math.random() * w,
            y: Math.random() * h,
            r: Math.random() * 1.8 + 0.6,
            vx: (Math.random() - 0.5) * 0.25,
            vy: (Math.random() - 0.5) * 0.25
          }));
          break;
        case SEASONS.WINTER:
          snowflakes = Array.from({ length: SNOW_COUNT }, () => createSnowflake());
          break;
        case SEASONS.SPRING:
          sakuras = Array.from({ length: SAKURA_COUNT }, () => createSakura());
          break;
        case SEASONS.SUMMER:
          waves = Array.from({ length: WAVE_COUNT }, (_, i) => ({
            y: h - 100 - i * 30,
            amplitude: 20 + i * 10,
            frequency: 0.01 - i * 0.002,
            speed: (0.02 + i * 0.005) / 2,
            phase: Math.random() * Math.PI * 2
          }));
          drops = [];
          break;
        case SEASONS.AUTUMN:
          leaves = Array.from({ length: LEAF_COUNT }, () => createLeaf());
          break;
      }
    }

    // === æ›´æ–°å­£èŠ‚æ ·å¼ï¼ˆä¼˜åŒ–å„å­£èŠ‚æŒ‰é’®é¢œè‰²ï¼Œä¿è¯åŒºåˆ†åº¦ï¼‰ ===
    function updateSeasonStyle() {
      const body = document.body;
      const root = document.documentElement;
      const h1 = document.querySelector("h1");
      const subtitle = document.querySelector(".subtitle");
      const footer = document.querySelector("footer");
      const allButtons = document.querySelectorAll(".main-btn, .health-btn, .wish-btn, .food-prefer-btn, .mini-calendar");

      switch (currentSeason) {
        case SEASONS.STARRY:
          // æ˜Ÿç©ºæ ·å¼ï¼šæ·±è‰²èƒŒæ™¯ + æµ…ç´«æŒ‰é’®
          body.style.background = `
            radial-gradient(1200px 800px at 20% 10%, #1b1f3b 0%, transparent 60%),
            radial-gradient(1000px 700px at 80% 20%, #2a174a 0%, transparent 65%),
            linear-gradient(180deg, #090b16, #05060c)
          `;
          root.style.setProperty("--fg", "#e8e8f0");
          root.style.setProperty("--muted", "#a0a0b8");
          root.style.setProperty("--accent", "#b7a8ff");
          root.style.setProperty("--border-light", "rgba(255,255,255,0.18)");
          root.style.setProperty("--bg-btn", "rgba(255,255,255,0.03)");
          break;
        case SEASONS.WINTER:
          // å†¬å¤©æ ·å¼ï¼šæ·±ç°è“èƒŒæ™¯ + æµ…è“æŒ‰é’®
          body.style.background = `
            linear-gradient(180deg, #2c3e50, #34495e),
            linear-gradient(to right, #1a2530, #2c3e50)
          `;
          root.style.setProperty("--fg", "#ecf0f1");
          root.style.setProperty("--muted", "#bdc3c7");
          root.style.setProperty("--accent", "#3498db");
          root.style.setProperty("--border-light", "rgba(255,255,255,0.25)");
          root.style.setProperty("--bg-btn", "rgba(255,255,255,0.08)");
          break;
        case SEASONS.SPRING:
          // æ˜¥å¤©æ ·å¼ï¼šå«©ç»¿è“å¤© + æ·¡ç²‰æŒ‰é’®
          body.style.background = `
            linear-gradient(180deg, #87ceeb, #90ee90),
            linear-gradient(to bottom, #7ccd7c 0%, #5f9ea0 100%)
          `;
          root.style.setProperty("--fg", "#2f4f2f");
          root.style.setProperty("--muted", "#4f6f4f");
          root.style.setProperty("--accent", "#ffb6c1");
          root.style.setProperty("--border-light", "rgba(47,79,47,0.2)");
          root.style.setProperty("--bg-btn", "rgba(255,255,255,0.15)");
          break;
        case SEASONS.SUMMER:
          // å¤å¤©æ ·å¼ï¼šæ²™æ»©è“æµ· + æ©™é»„æŒ‰é’®
          body.style.background = `
            linear-gradient(180deg, #87ceeb, #f5deb3),
            linear-gradient(to bottom, #00bfff 0%, #fffacd 100%)
          `;
          root.style.setProperty("--fg", "#1e3a8a");
          root.style.setProperty("--muted", "#3b5998");
          root.style.setProperty("--accent", "#ff9800");
          root.style.setProperty("--border-light", "rgba(30,58,138,0.2)");
          root.style.setProperty("--bg-btn", "rgba(255,255,255,0.12)");
          break;
        case SEASONS.AUTUMN:
          // ç§‹å¤©æ ·å¼ï¼šçº¢å¶é»„å¶ + æ·±æ©™æŒ‰é’®
          body.style.background = `
            linear-gradient(180deg, #cd5c5c, #daa520),
            linear-gradient(to bottom, #b8860b 0%, #dc143c 100%)
          `;
          root.style.setProperty("--fg", "#fff8dc");
          root.style.setProperty("--muted", "#f5f5dc");
          root.style.setProperty("--accent", "#ff7f50");
          root.style.setProperty("--border-light", "rgba(255,248,220,0.25)");
          root.style.setProperty("--bg-btn", "rgba(0,0,0,0.1)");
          break;
      }

      // æ›´æ–°æ‰€æœ‰æ–‡å­—å’ŒæŒ‰é’®æ ·å¼è¿‡æ¸¡
      h1.style.color = getComputedStyle(root).getPropertyValue("--fg");
      subtitle.style.color = getComputedStyle(root).getPropertyValue("--muted");
      footer.style.color = getComputedStyle(root).getPropertyValue("--muted");
      allButtons.forEach(btn => {
        btn.style.borderColor = getComputedStyle(root).getPropertyValue("--border-light");
        btn.style.background = getComputedStyle(root).getPropertyValue("--bg-btn");
      });
    }

    // === å†¬å¤©ï¼šåˆ›å»ºé›ªèŠ± ===
    function createSnowflake() {
      const size = Math.random() * (SNOW_SIZE_RANGE[1] - SNOW_SIZE_RANGE[0]) + SNOW_SIZE_RANGE[0];
      return {
        x: Math.random() * w,
        y: Math.random() * -h,
        size,
        speed: Math.random() * (SNOW_SPEED_RANGE[1] - SNOW_SPEED_RANGE[0]) + SNOW_SPEED_RANGE[0],
        vx: (Math.random() - 0.5) * 0.3,
        vy: 0,
        stacked: false,
        stackY: h,
        stackX: Math.random() * w
      };
    }

    // === å†¬å¤©ï¼šæ›´æ–°é›ªèŠ± - ä¿®å¤æ»šåŠ¨è·ŸéšBUG ===
    function updateSnowflakes() {
      // å®æ—¶æ›´æ–°å…ƒç´ è¾¹ç•Œï¼ˆè§£å†³æ»šåŠ¨é—®é¢˜ï¼‰
      cacheElementBounds();

      for (let i = 0; i < snowflakes.length; i++) {
        const snow = snowflakes[i];

        if (!snow.stacked) {
          // å¶å°”å¾€ä¸Šé£
          if (Math.random() < SNOW_FLOAT_CHANCE) {
            snow.vy = -snow.speed * 0.8;
          } else {
            snow.vy = snow.speed;
          }

          // åº”ç”¨é¼ æ ‡é£åŠ›
          snow.vx += mouse.speedX * 0.0003;

          // æ›´æ–°ä½ç½®
          snow.x += snow.vx;
          snow.y += snow.vy;

          // è¾¹ç•Œæ£€æµ‹ï¼ˆå·¦å³å¾ªç¯ï¼‰
          if (snow.x < 0) snow.x = w;
          if (snow.x > w) snow.x = 0;

          // å †ç§¯æ£€æµ‹ï¼ˆå…ƒç´ é¡¶éƒ¨/åœ°é¢ï¼‰
          let isStacked = false;
          for (const bound of elementBounds) {
            if (
              snow.x > bound.left &&
              snow.x < bound.right &&
              snow.y + snow.size >= bound.top &&
              snow.y < bound.top + 10
            ) {
              snow.stacked = true;
              snow.stackY = bound.top;
              snow.stackX = snow.x; // è®°å½•å †ç§¯æ—¶çš„Xåæ ‡
              isStacked = true;
              break;
            }
          }

          // åœ°é¢å †ç§¯
          if (!isStacked && snow.y + snow.size >= h) {
            snow.stacked = true;
            snow.stackY = h;
            snow.stackX = snow.x;
          }

          // æŒç»­ç”Ÿæˆæ–°é›ªèŠ±
          if (snow.y > h + snow.size) {
            snowflakes[i] = createSnowflake();
          }
        } else {
          // å·²å †ç§¯ï¼šè·Ÿéšå…ƒç´ å®æ—¶ä½ç½®æ›´æ–°ï¼ˆä¿®å¤æ»šåŠ¨BUGï¼‰
          snow.y = snow.stackY - snow.size;
          snow.x = snow.stackX;

          // éªŒè¯å †ç§¯è¾¹ç•Œæ˜¯å¦ä»æœ‰æ•ˆï¼Œæ— æ•ˆåˆ™å–æ¶ˆå †ç§¯
          let boundValid = false;
          for (const bound of elementBounds) {
            if (
              snow.stackX > bound.left &&
              snow.stackX < bound.right &&
              snow.stackY === bound.top
            ) {
              snow.stackY = bound.top; // åŒæ­¥å…ƒç´ æœ€æ–°topä½ç½®
              boundValid = true;
              break;
            }
          }
          if (!boundValid && snow.stackY !== h) {
            snow.stacked = false; // å…ƒç´ æ¶ˆå¤±åˆ™é‡æ–°é£˜è½
          }
        }
      }
    }

    // === å†¬å¤©ï¼šç»˜åˆ¶é›ªèŠ± ===
    function drawSnowflakes() {
      ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
      for (const snow of snowflakes) {
        ctx.beginPath();
        ctx.arc(snow.x, snow.y, snow.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // === æ˜¥å¤©ï¼šåˆ›å»ºæ¨±èŠ± - ä¼˜åŒ–ï¼šæ·¡ç²‰è‰² ===
    function createSakura() {
      const size = Math.random() * (SAKURA_SIZE_RANGE[1] - SAKURA_SIZE_RANGE[0]) + SAKURA_SIZE_RANGE[0];
      return {
        x: Math.random() * w,
        y: Math.random() * -h,
        size,
        speed: Math.random() * (SAKURA_SPEED_RANGE[1] - SAKURA_SPEED_RANGE[0]) + SAKURA_SPEED_RANGE[0],
        vx: (Math.random() - 0.5) * 0.2,
        vy: 0,
        angle: Math.random() * Math.PI * 2,
        rotateSpeed: (Math.random() - 0.5) * 0.01,
        stacked: false,
        stackY: h,
        stackX: Math.random() * w
      };
    }

    // === æ˜¥å¤©ï¼šæ›´æ–°æ¨±èŠ± - ä¿®å¤æ»šåŠ¨è·ŸéšBUG ===
    function updateSakuras() {
      // å®æ—¶æ›´æ–°å…ƒç´ è¾¹ç•Œï¼ˆè§£å†³æ»šåŠ¨é—®é¢˜ï¼‰
      cacheElementBounds();

      for (let i = 0; i < sakuras.length; i++) {
        const sakura = sakuras[i];

        if (!sakura.stacked) {
          // å¶å°”å¾€ä¸Šé£
          if (Math.random() < SAKURA_FLOAT_CHANCE) {
            sakura.vy = -sakura.speed * 0.7;
          } else {
            sakura.vy = sakura.speed;
          }

          // åº”ç”¨é¼ æ ‡é£åŠ›
          sakura.vx += mouse.speedX * 0.0002;

          // æ›´æ–°ä½ç½®å’Œæ—‹è½¬
          sakura.x += sakura.vx + Math.sin(Date.now() * 0.0003 + i) * 0.1;
          sakura.y += sakura.vy;
          sakura.angle += sakura.rotateSpeed;

          // è¾¹ç•Œæ£€æµ‹
          if (sakura.x < 0) sakura.x = w;
          if (sakura.x > w) sakura.x = 0;

          // å †ç§¯æ£€æµ‹
          let isStacked = false;
          for (const bound of elementBounds) {
            if (
              sakura.x > bound.left &&
              sakura.x < bound.right &&
              sakura.y + sakura.size >= bound.top &&
              sakura.y < bound.top + 10
            ) {
              sakura.stacked = true;
              sakura.stackY = bound.top;
              sakura.stackX = sakura.x;
              isStacked = true;
              break;
            }
          }

          // åœ°é¢å †ç§¯
          if (!isStacked && sakura.y + sakura.size >= h) {
            sakura.stacked = true;
            sakura.stackY = h;
            sakura.stackX = sakura.x;
          }

          // æŒç»­ç”Ÿæˆæ–°æ¨±èŠ±
          if (sakura.y > h + sakura.size) {
            sakuras[i] = createSakura();
          }
        } else {
          // å·²å †ç§¯ï¼šè·Ÿéšå…ƒç´ å®æ—¶ä½ç½®æ›´æ–°ï¼ˆä¿®å¤æ»šåŠ¨BUGï¼‰
          sakura.y = sakura.stackY - sakura.size;
          sakura.x = sakura.stackX;

          // éªŒè¯å †ç§¯è¾¹ç•Œæ˜¯å¦ä»æœ‰æ•ˆ
          let boundValid = false;
          for (const bound of elementBounds) {
            if (
              sakura.stackX > bound.left &&
              sakura.stackX < bound.right &&
              sakura.stackY === bound.top
            ) {
              sakura.stackY = bound.top;
              boundValid = true;
              break;
            }
          }
          if (!boundValid && sakura.stackY !== h) {
            sakura.stacked = false;
          }
        }
      }
    }

    // === æ˜¥å¤©ï¼šç»˜åˆ¶æ¨±èŠ± - ä¼˜åŒ–ï¼šæ·¡ç²‰è‰² ===
    function drawSakuras() {
      for (const sakura of sakuras) {
        ctx.save();
        ctx.translate(sakura.x, sakura.y);
        ctx.rotate(sakura.angle);
        // æ·¡ç²‰è‰²ï¼šé™ä½ä¸é€æ˜åº¦ï¼Œè°ƒæµ…è‰²è°ƒ
        ctx.fillStyle = "rgba(255, 182, 193, 0.7)";
        ctx.beginPath();
        ctx.ellipse(0, 0, sakura.size, sakura.size * 0.8, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
    }

    // === å¤å¤©ï¼šæ›´æ–°æµ·æµªå’Œæ°´ç  ===
    function updateSummer() {
      const now = Date.now();

      // æ›´æ–°æµ·æµª
      for (const wave of waves) {
        wave.phase += wave.speed;
      }

      // ç”Ÿæˆæµ·æµªï¼ˆ3-7ç§’ä¸€æ¬¡ï¼‰
      if (now - lastWaveTime > Math.random() * (WAVE_INTERVAL_RANGE[1] - WAVE_INTERVAL_RANGE[0]) + WAVE_INTERVAL_RANGE[0]) {
        generateDrops();
        lastWaveTime = now;
      }

      // æ›´æ–°æ°´ç 
      for (let i = drops.length - 1; i >= 0; i--) {
        const drop = drops[i];
        drop.age += 16;
        drop.alpha = 1 - (drop.age / drop.fadeTime);

        // æ°´ç ä¸‹è½ï¼ˆé€Ÿåº¦å‡æ…¢ï¼‰
        drop.y += drop.speed * 0.5;
        drop.vx *= 0.98;
        drop.x += drop.vx;

        // ç§»é™¤è¿‡æœŸæ°´ç 
        if (drop.alpha <= 0 || drop.y > h) {
          drops.splice(i, 1);
        }
      }
    }

    // === å¤å¤©ï¼šç”Ÿæˆæ°´ç  ===
    function generateDrops() {
      DROP_TYPES.forEach(type => {
        const count = Math.floor(Math.random() * (type.count[1] - type.count[0]) + type.count[0]);
        for (let i = 0; i < count; i++) {
          drops.push({
            x: Math.random() * w,
            y: Math.random() * h * 0.6,
            size: type.size,
            speed: Math.random() * 0.3 + 0.1,
            vx: (Math.random() - 0.5) * 1.5,
            alpha: 1,
            age: 0,
            fadeTime: type.fadeTime
          });
        }
      });
    }

    // === å¤å¤©ï¼šç»˜åˆ¶æµ·æµªå’Œæ°´ç  ===
    function drawSummer() {
      // ç»˜åˆ¶æµ·æµª
      for (let i = 0; i < waves.length; i++) {
        const wave = waves[i];
        ctx.beginPath();
        ctx.moveTo(0, wave.y);
        for (let x = 0; x <= w; x += 5) {
          const y = wave.y + Math.sin(x * wave.frequency + wave.phase) * wave.amplitude;
          ctx.lineTo(x, y);
        }
        ctx.lineTo(w, h);
        ctx.lineTo(0, h);
        ctx.closePath();
        const opacity = 0.3 - (i * 0.1);
        ctx.fillStyle = `rgba(0, 191, 255, ${opacity})`;
        ctx.fill();
      }

      // ç»˜åˆ¶æ°´ç 
      for (const drop of drops) {
        ctx.globalAlpha = drop.alpha;
        ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
        ctx.beginPath();
        ctx.arc(drop.x, drop.y, drop.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    // === ç§‹å¤©ï¼šåˆ›å»ºæ ‘å¶ - ä¼˜åŒ–ï¼šæ›´å¤§ã€æ›´æ…¢ã€3ç§é¢œè‰² ===
    function createLeaf() {
      const size = Math.random() * (LEAF_SIZE_RANGE[1] - LEAF_SIZE_RANGE[0]) + LEAF_SIZE_RANGE[0];
      return {
        x: Math.random() * w,
        y: Math.random() * -h,
        size,
        speed: Math.random() * (LEAF_SPEED_RANGE[1] - LEAF_SPEED_RANGE[0]) + LEAF_SPEED_RANGE[0],
        vx: (Math.random() - 0.5) * 0.3,
        vy: 0,
        angle: Math.random() * Math.PI * 2,
        rotateSpeed: (Math.random() - 0.5) * 0.015,
        color: LEAF_COLORS[Math.floor(Math.random() * LEAF_COLORS.length)] // ä»…3ç§é¢œè‰²
      };
    }

    // === ç§‹å¤©ï¼šæ›´æ–°æ ‘å¶ - ä¼˜åŒ–ï¼šæ›´å¤§ã€æ›´æ…¢ã€ä¸å †ç§¯ ===
    function updateLeaves() {
      for (let i = 0; i < leaves.length; i++) {
        const leaf = leaves[i];

        // å¶å°”å¾€ä¸Šé£
        if (Math.random() < LEAF_FLOAT_CHANCE) {
          leaf.vy = -leaf.speed * 0.6;
        } else {
          leaf.vy = leaf.speed;
        }

        // åº”ç”¨é¼ æ ‡é£åŠ›
        leaf.vx += mouse.speedX * 0.00025;

        // æ›´æ–°ä½ç½®å’Œæ—‹è½¬
        leaf.x += leaf.vx + Math.sin(Date.now() * 0.0004 + i) * 0.15;
        leaf.y += leaf.vy;
        leaf.angle += leaf.rotateSpeed;

        // è¾¹ç•Œæ£€æµ‹ï¼ˆå¾ªç¯ç”Ÿæˆï¼Œä¸å †ç§¯ï¼‰
        if (leaf.x < 0) leaf.x = w;
        if (leaf.x > w) leaf.x = 0;
        if (leaf.y > h + leaf.size) {
          leaves[i] = createLeaf();
        } else if (leaf.y < -leaf.size) {
          leaf.y = -leaf.size;
        }
      }
    }

    // === ç§‹å¤©ï¼šç»˜åˆ¶æ ‘å¶ ===
    function drawLeaves() {
      for (const leaf of leaves) {
        ctx.save();
        ctx.translate(leaf.x, leaf.y);
        ctx.rotate(leaf.angle);
        ctx.fillStyle = leaf.color;
        ctx.beginPath();
        ctx.moveTo(0, -leaf.size);
        ctx.lineTo(leaf.size / 2, leaf.size / 2);
        ctx.lineTo(0, leaf.size);
        ctx.lineTo(-leaf.size / 2, leaf.size / 2);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }
    }

    // === æ˜Ÿç©ºï¼šæ›´æ–°å’Œç»˜åˆ¶ ===
    function updateStars() {
      for (const star of stars) {
        star.x += star.vx;
        star.y += star.vy;

        if (star.x < 0 || star.x > w) star.vx *= -1;
        if (star.y < 0 || star.y > h) star.vy *= -1;
      }
    }

    function drawStars() {
      for (const star of stars) {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.r, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(200,190,255,0.5)";
        ctx.fill();
      }
    }

    // === é¼ æ ‡çŠ¶æ€æ›´æ–° ===
    function updateMouse(e) {
      mouse.prevX = mouse.x;
      mouse.prevY = mouse.y;
      mouse.x = e.clientX;
      mouse.y = e.clientY;

      // è®¡ç®—é¼ æ ‡ç§»åŠ¨é€Ÿåº¦ï¼ˆé£åŠ›ï¼‰- å‡å¼±é£åŠ›å½±å“
      mouse.speedX = (mouse.x - mouse.prevX) * 0.3;
      mouse.speedY = (mouse.y - mouse.prevY) * 0.3;
    }

    // === æå…‰å°¾è¿¹ï¼ˆä»…æ˜Ÿç©ºæ ·å¼ï¼‰ ===
    const trails = [];
    function updateTrails() {
      if (currentSeason !== SEASONS.STARRY) return;

      trails.push({
        x: mouse.x,
        y: mouse.y,
        life: 60
      });

      for (let i = trails.length - 1; i >= 0; i--) {
        const t = trails[i];
        t.life--;

        if (t.life <= 0) trails.splice(i, 1);
      }
    }

    function drawTrails() {
      if (currentSeason !== SEASONS.STARRY) return;

      for (const t of trails) {
        const alpha = t.life / 60;
        ctx.beginPath();
        ctx.arc(t.x, t.y, 18 * alpha, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(150,200,255,${alpha * 0.35})`;
        ctx.fill();
      }
    }

    // === ä¸»åŠ¨ç”»å¾ªç¯ ===
    function animate() {
      // æ¸…ç©ºç”»å¸ƒ
      ctx.clearRect(0, 0, w, h);

      // æ›´æ–°å¯¹åº”å­£èŠ‚å…ƒç´ 
      switch (currentSeason) {
        case SEASONS.STARRY:
          updateStars();
          updateTrails();
          drawStars();
          drawTrails();
          break;
        case SEASONS.WINTER:
          updateSnowflakes();
          drawSnowflakes();
          break;
        case SEASONS.SPRING:
          updateSakuras();
          drawSakuras();
          break;
        case SEASONS.SUMMER:
          updateSummer();
          drawSummer();
          break;
        case SEASONS.AUTUMN:
          updateLeaves();
          drawLeaves();
          break;
      }

      // æŒ‰é’®å…‰æ–‘è·Ÿéš
      document.querySelectorAll(".main-btn, .health-btn, .wish-btn, .food-prefer-btn").forEach(btn => {
        btn.addEventListener("mousemove", e => {
          const rect = btn.getBoundingClientRect();
          btn.style.setProperty("--x", `${e.clientX - rect.left}px`);
          btn.style.setProperty("--y", `${e.clientY - rect.top}px`);
        });
      });

      // è¯·æ±‚ä¸‹ä¸€å¸§
      requestAnimationFrame(animate);
    }

    // === äº‹ä»¶ç›‘å¬ ===
    window.addEventListener("resize", resize);
    window.addEventListener("mousemove", updateMouse);
    window.addEventListener("scroll", () => {
      // æ»šåŠ¨æ—¶å¼ºåˆ¶æ›´æ–°å…ƒç´ è¾¹ç•Œï¼Œç¡®ä¿é›ªèŠ±/æ¨±èŠ±è·Ÿéš
      cacheElementBounds();
    });
    seasonSwitchBtn.addEventListener("click", switchSeason);

    // === åˆå§‹åŒ–æ‰§è¡Œ ===
    window.onload = init;
  </script>
</body>
</html>
