<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>小德的饭店排名</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body {
  margin: 40px;
  background: #ffffff;
  color: #222;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
               Roboto, Helvetica, Arial, "PingFang SC", "Microsoft YaHei";
}

h1 {
  font-weight: 500;
  margin-bottom: 16px;

}
      <div style="margin-bottom:16px;">
  位置：
  <input id="filter-location" placeholder="如：南京" />
  &nbsp;&nbsp;
  类别：
  <input id="filter-category" placeholder="如：粤菜" />
  &nbsp;&nbsp;
  <button id="reset">总榜</button>
</div>


table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

th, td {
  border: 1px solid #d0d0d0;
  padding: 8px 10px;
  text-align: center;
  white-space: nowrap;
}

th {
  background: #f2f2f2;
  font-weight: 500;
}

/* 高饱和评分色（增强版） */
.score-blue    { background: #9dc3e6; }  /* 深一点的蓝 */
.score-purple { background: #b4a7d6; }  /* 明显紫 */
.score-orange { background: #f4b183; }  /* 橙 */
.score-red    { background: #e06666; }  /* 红 */

</style>
</head>

<body>
<h1>小德的饭店排名</h1>
<div id="table">加载中…</div>
    <div style="margin-bottom:16px;">
  位置：
  <input id="filter-location" placeholder="如：南京" />
  &nbsp;&nbsp;
  类别：
  <input id="filter-category" placeholder="如：粤菜" />
  &nbsp;&nbsp;
  <button id="reset">总榜</button>
</div>


<script>
  let originalData = [];
fetch("饭店评分.xlsx")
  .then(r => r.arrayBuffer())
  .then(buf => {
    const wb = XLSX.read(buf, { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
   originalData = XLSX.utils.sheet_to_json(sheet);
render(originalData);

  })
  .catch(() => {
    document.getElementById("table").innerText = "未找到 data.xlsx";
  });

function scoreClass(v) {
  if (typeof v !== "number") return "";
  if (v >= 90) return "score-red";
  if (v >= 80) return "score-orange";
  if (v >= 70) return "score-purple";
  if (v >= 60) return "score-blue";
  return "";
}

function isValidHeader(h) {
  if (!h) return false;                 // 空字符串
  if (h.startsWith("__EMPTY")) return false;
  return true;
}

function render(data) {
  if (!data.length) return;

  /* 关键：彻底过滤空列 */
  const headers = Object.keys(data[0]).filter(isValidHeader);

  const table = document.createElement("table");
  const thead = document.createElement("thead");
  const tbody = document.createElement("tbody");

  const trHead = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    trHead.appendChild(th);
  });
  thead.appendChild(trHead);

  data.forEach(row => {
    const tr = document.createElement("tr");
    headers.forEach(key => {
      const td = document.createElement("td");
      const val = row[key];

      /* 排名列永远白色 */
      if (key !== "排名" && typeof val === "number") {
        td.className = scoreClass(val);
      }

      td.textContent = val ?? "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  table.appendChild(thead);
  table.appendChild(tbody);

  const container = document.getElementById("table");
  container.innerHTML = "";
  container.appendChild(table);
}
  document.getElementById("filter-location").addEventListener("input", applyFilter);
document.getElementById("filter-category").addEventListener("input", applyFilter);
document.getElementById("reset").addEventListener("click", () => {
  document.getElementById("filter-location").value = "";
  document.getElementById("filter-category").value = "";
  render(originalData);
});

function applyFilter() {
  const loc = document.getElementById("filter-location").value.trim();
  const cat = document.getElementById("filter-category").value.trim();

  const filtered = originalData.filter(row => {
    const locationMatch = loc
      ? String(row["位置"] || "").includes(loc)
      : true;

    const categoryMatch = cat
      ? String(row["类别"] || "").includes(cat)
      : true;

    return locationMatch && categoryMatch;
  });

  render(filtered);
}
</script>
</body>
</html>

