<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>小德的饭店排名</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root {
  /* ===== 纸张 / 杂志风 ===== */
  --bg-paper: #F6F4F1;
  --bg-panel: #FFFFFF;
  --bg-soft: #EFEDE8;

  --ink-main: #2E2E2E;
  --ink-sub: #7A7A7A;
  --ink-fade: #B8B8B8;

  --accent-warm: #D8C7A2;

  --radius-lg: 22px;
  --radius-md: 14px;
  --radius-sm: 10px;

  --shadow-soft: 0 6px 18px rgba(0,0,0,0.06);
}

* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
    "PingFang SC", "Noto Sans SC", sans-serif;
}

body {
  margin: 0;
  padding: 48px 32px 120px;
  background:
    radial-gradient(1200px 600px at 20% 0%, #FFFFFF 0%, transparent 60%),
    var(--bg-paper);
  color: var(--ink-main);
}

/* ===== 标题 ===== */
h1 {
  font-weight: 500;
  font-size: 2.2rem;
  letter-spacing: .02em;
  margin-bottom: 28px;
}

/* ===== 筛选区（像菜单筛选） ===== */
.controls {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 26px;
  padding: 16px 20px;
  background: var(--bg-panel);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-soft);
  width: fit-content;
}

.controls input {
  padding: 8px 16px;
  border-radius: 999px;
  border: 1px solid #DDD;
  background: #FFF;
  font-size: .9rem;
}

.controls input:focus {
  outline: none;
  border-color: var(--accent-warm);
  box-shadow: 0 0 0 3px rgba(216,199,162,0.25);
}

.controls button {
  padding: 8px 18px;
  border-radius: 999px;
  border: 1px solid var(--accent-warm);
  background: #FFF;
  font-size: .85rem;
  cursor: pointer;
}

.controls button:hover {
  background: var(--bg-soft);
}

/* ===== 表格容器（像评分手册） ===== */
#table {
  margin-top: 18px;
}

/* ===== 表格整体 ===== */
table {
  border-collapse: separate;
  border-spacing: 0;
  font-size: 13px;
  background: var(--bg-panel);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-soft);
}

/* ===== 表头 ===== */
th {
  padding: 10px 14px;
  font-weight: 500;
  color: var(--ink-sub);
  background: var(--bg-soft);
  border-bottom: 1px solid #E2E0DA;
  white-space: nowrap;
}

/* ===== 单元格 ===== */
td {
  padding: 9px 14px;
  text-align: center;
  white-space: nowrap;
  border-bottom: 1px solid #EEE;
}

tr:last-child td {
  border-bottom: none;
}

/* ===== 悬停行 ===== */
tbody tr:hover {
  background: #FAF9F6;
}

/* ===== 装备品阶式高饱和评分 ===== */

.score-blue {
  background: linear-gradient(135deg, #2f80ff, #6fb1ff);
  color: #ffffff;
  font-weight: 600;
  text-shadow: 0 0 6px rgba(80,140,255,0.6);
}

.score-purple {
  background: linear-gradient(135deg, #7b3fe4, #c38bff);
  color: #ffffff;
  font-weight: 600;
  text-shadow: 0 0 6px rgba(160,100,255,0.6);
}

.score-orange {
  background: linear-gradient(135deg, #ff8a00, #ffd36a);
  color: #ffffff;
  font-weight: 700;
  text-shadow: 0 0 6px rgba(255,180,60,0.6);
}

.score-red {
  background: linear-gradient(135deg, #ff2d2d, #ff7a7a);
  color: #ffffff;
  font-weight: 700;
  text-shadow: 0 0 8px rgba(255,80,80,0.7);
}


/* ===== 响应式 ===== */
@media (max-width: 900px) {
  body {
    padding: 32px 16px 100px;
  }

  h1 {
    font-size: 1.8rem;
  }

  .controls {
    flex-wrap: wrap;
  }
}
</style>

</head>

<body>
<h1>小德的饭店排名</h1>

<div class="controls">
  位置：
  <input id="filter-location" placeholder="如：南京">
  类别：
  <input id="filter-category" placeholder="如：粤菜">
  <button id="reset">总榜</button>
</div>

<div id="table">加载中…</div>

<script>
let originalData = [];

fetch("饭店评分.xlsx")
  .then(r => r.arrayBuffer())
  .then(buf => {
    const wb = XLSX.read(buf, { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    originalData = XLSX.utils.sheet_to_json(sheet);
    render(originalData);
  })
  .catch(() => {
    document.getElementById("table").innerText = "未找到 饭店评分.xlsx";
  });

function scoreClass(v) {
  if (typeof v !== "number") return "";
  if (v >= 90) return "score-red";
  if (v >= 80) return "score-orange";
  if (v >= 70) return "score-purple";
  if (v >= 60) return "score-blue";
  return "";
}

function isValidHeader(h) {
  if (!h) return false;
  if (h === "年份") return false;           // 删除年份列
  if (h.startsWith("__EMPTY")) return false;
  return true;
}

function render(data) {
  if (!data.length) {
    document.getElementById("table").innerText = "无匹配结果";
    return;
  }

  const headers = Object.keys(data[0]).filter(isValidHeader);

  const table = document.createElement("table");
  const thead = document.createElement("thead");
  const tbody = document.createElement("tbody");

  const trHead = document.createElement("tr");
  headers.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    trHead.appendChild(th);
  });
  thead.appendChild(trHead);

  data.forEach(row => {
    const tr = document.createElement("tr");
    headers.forEach(key => {
      const td = document.createElement("td");
      const val = row[key];

      /* 排名列不着色 */
      if (key !== "排名" && typeof val === "number") {
        td.className = scoreClass(val);
      }

      td.textContent = val ?? "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  table.appendChild(thead);
  table.appendChild(tbody);

  const container = document.getElementById("table");
  container.innerHTML = "";
  container.appendChild(table);
}

/* 筛选 */
document.getElementById("filter-location").addEventListener("input", applyFilter);
document.getElementById("filter-category").addEventListener("input", applyFilter);

document.getElementById("reset").addEventListener("click", () => {
  document.getElementById("filter-location").value = "";
  document.getElementById("filter-category").value = "";
  render(originalData);
});

function applyFilter() {
  const loc = document.getElementById("filter-location").value.trim();
  const cat = document.getElementById("filter-category").value.trim();

  const filtered = originalData.filter(row => {
    const locationMatch = loc
      ? String(row["位置"] || "").includes(loc)
      : true;

    const categoryMatch = cat
      ? String(row["类别"] || "").includes(cat)
      : true;

    return locationMatch && categoryMatch;
  });

  render(filtered);
}
</script>
</body>
</html>
